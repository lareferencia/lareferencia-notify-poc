<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>John DOE CV LATTES PAGE</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      text-align: left;
      padding: 8px;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    tr:hover {
      background-color: #ddd;
    }
    .big-red-button {
      font-size: 24px;
      background-color: red;
      color: white;
      padding: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>John DOE CV LATTES PAGE</h1>
  <h3>John DOE Scientific Articles LIST</h1>
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Year</th>
        <th>Authors</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Article 1: One article (same article diffent case)</td>
        <td>2021</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 1: one   Article (same article diffent case)</td>
        <td>2021</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 3</td>
        <td>2019</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 4</td>
        <td>2018</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 5</td>
        <td>2017</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 6</td>
        <td>2016</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 7</td>
        <td>2015</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 8</td>
        <td>2014</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 9</td>
        <td>2013</td>
        <td>John Doe, Jane Smith</td>
      </tr>
      <tr>
        <td>Article 10</td>
        <td>2012</td>
        <td>John Doe, Jane Smith</td>
      </tr>
    </tbody>
  </table>
</body>

<button class="big-red-button" id="loadButton">Simulate the dinamic update of the Notify Enabler Widget</button>


<!-- BEGIN POC Script -->
<!-- This POC script will be later packed using webpack -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.18.0/js/md5.min.js"></script>
  <script>

   // this function normalize the string to be used in the hash function by removing special characters and extra spaces and converting to uppercase
   function normalizeString(str) {
      return str.trim().toUpperCase().replace(/[^\w\s]/g, '').replace(/\s+/g, ' ').trim();
    }

   // this function will be called when the page is loaded 
   function notifyEnabler() {

      // get the url of the page,
      var url = window.location.href;
      // clean the url from the hash
      url = url.split('#')[0];

      const table = document.querySelector('table');
      
      // add the extra columns to the table
      const headerRow = table.rows[0];
      const uniqueUrlHeader = headerRow.insertCell(3);
      uniqueUrlHeader.innerHTML = '<b>Unique URL</b>';
      const certificationStatusHeader = headerRow.insertCell(4);
      certificationStatusHeader.innerHTML = '<b>Certification Status</b>';
      
      // get all the rows in the table  
      const rows = table.querySelectorAll('tbody tr');
      
      // for each row in the table
      rows.forEach(row => {

        // get the normalized version of title, year and authors
        const title = normalizeString(row.querySelector('td:nth-child(1)').textContent);
        const year = normalizeString(row.querySelector('td:nth-child(2)').textContent);
        const authors = normalizeString(row.querySelector('td:nth-child(3)').textContent);

        // calculate the hash and add it to the table  
        const hash = md5(title + authors + year);
        const uniqueUrl = `${url}#${hash}`;

       // create a new cell with the anchor and add it to the row
        const cell = document.createElement('td');
        const anchor = document.createElement('a');
        anchor.href = `#${hash}`;
        anchor.textContent = uniqueUrl 
        cell.appendChild(anchor);
        row.appendChild(cell);

        // create a new cell for the certification status and add it to the row
        const certifiedCell = document.createElement('td');
        row.appendChild(certifiedCell);

        // call the is_certified() function for the unique URL and update the certification status cell
        const isCertified = is_certified(uniqueUrl);
        if (isCertified) {
          certifiedCell.textContent = 'CERTIFIED';
        } else {
          const askButton = document.createElement('button');
          askButton.textContent = 'Ask for certification';
          certifiedCell.appendChild(askButton);

          // add an event listener to the askButton to call the askForCertification() function when clicked
          askButton.addEventListener('click', () => {
          askForCertification(uniqueUrl);
        }); 
        }
      });
    }

    // this function will be called when the loadButton is clicked
    const loadButton = document.getElementById('loadButton');
    loadButton.addEventListener('click', () => {
     notifyEnabler();
    });
  </script>
 <!-- END POC Script -->

 <!-- Simple Linked Data Notification Sender -->
<script>
  function askForCertification(uniqueUrl) {
    // create the notification payload
    inboxUrl = 'http://notify-inbox.info/inbox';

    const payload = {
      "@context": [
        "https://www.w3.org/ns/activitystreams",
        "https://purl.org/coar/notify"
      ],
      "actor": {
        "id": "https://orcid.org/0000-0002-1825-0097",
        "name": "Josiah Carberry",
        "type": "Person"
      },
      "id": "urn:uuid:0370c0fb-bb78-4a9b-87f5-bed307a509dd",
      "object": {
        "id": "https://research-organisation.org/repository/preprint/201203/421/",
        "ietf:cite-as": "https://doi.org/10.5555/12345680",
        "type": "sorg:AboutPage",
        "url": {
          "id": "https://research-organisation.org/repository/preprint/201203/421/content.pdf",
          "mediaType": "application/pdf",
          "type": [
            "Article",
            "sorg:ScholarlyArticle"
          ]
        }
      },
      "origin": {
        "id": "https://research-organisation.org/repository",
        "inbox": "https://research-organisation.org/inbox/",
        "type": "Service"
      },
      "target": {
        "id": "https://overlay-journal.com/system",
        "inbox": "https://overlay-journal.com/inbox/",
        "type": "Service"
      },
      "type": [
        "Offer",
        "coar-notify:EndorsementAction"
      ]
    }

    // send the notification to the inbox URL
    fetch(inboxUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/ld+json'
      },
      body: JSON.stringify(payload)
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to send notification');
      }
      console.log('Notification sent successfully');
      // open an alert to inform the user that the notification was sent successfully
      alert('Notification sent successfully');
    })
    .catch(error => {
      console.error(error);
    });
  }
</script>


 <!-- Simulate certify web service call to be implemented by the National Agregator service -->
<!-- BEGIN Is certified? Script -->
<script>

  // this funcion will be an async call to the certify web service running on the National Agregator service 
  function is_certified(uniqueUrl) {

    hash = uniqueUrl.split('#')[1];

    // this is a harcoded simulation of the certify web service call
    if (hash == 'edb695d70410a347b95bfb0a2b5e972b' || hash == 'aced767c961059bc049568fa12878e98') {
      return true;
    } else {
      return false;
    }
}
  
</script>
<!-- END Is certified? Script -->
 
 
</html>